{% extends 'calendar_app/base.html' %}

{% block content %}
<!-- Calendar Grid -->
<div class="bg-white border-2 border-black rounded-lg p-4 md:p-6 mb-6 md:mb-8 shadow-md">
    <div class="flex justify-between items-center mb-4">
        <a href="?year={{ prev_year }}&month={{ prev_month }}"
            class="text-gray-500 hover:text-primary transition">&larr;
            Prev</a>
        <h3 class="text-xl font-bold text-center text-primary">{{ month_name }} {{ year }}</h3>
        <a href="?year={{ next_year }}&month={{ next_month }}" class="text-gray-500 hover:text-primary transition">Next
            &rarr;</a>
    </div>

    <div class="grid grid-cols-7 gap-1 text-center mb-2">
        <div class="text-gray-400 text-sm font-semibold">Mon</div>
        <div class="text-gray-400 text-sm font-semibold">Tue</div>
        <div class="text-gray-400 text-sm font-semibold">Wed</div>
        <div class="text-gray-400 text-sm font-semibold">Thu</div>
        <div class="text-gray-400 text-sm font-semibold">Fri</div>
        <div class="text-gray-400 text-sm font-semibold">Sat</div>
        <div class="text-gray-400 text-sm font-semibold">Sun</div>
    </div>

    <div class="grid grid-cols-7 gap-1">
        {% for week in calendar_weeks %}
        {% for day_info in week %}
        <div
            class="h-24 border border-gray-300 rounded p-1 relative {% if day_info.day != 0 %}bg-black bg-opacity-50 hover:bg-opacity-90 hover:scale-105 hover:shadow-lg transition transform{% else %}bg-transparent border-transparent{% endif %}">
            {% if day_info.day != 0 %}
            <span class="text-white text-sm block mb-1 font-medium">{{ day_info.day }}</span>
            <div class="space-y-1">
                {% for event in day_info.events %}
                <div class="text-[10px] truncate px-1 rounded bg-orange-100 text-orange-800 border-l-2 border-primary"
                    title="{{ event.title }}">
                    {{ event.title }}
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endfor %}
        {% endfor %}
    </div>
</div>

<!-- Upcoming Events Section with Border Box -->
<div class="bg-white border-2 border-primary rounded-lg shadow-lg overflow-hidden mb-6">
    <!-- Header Section -->
    <div class="bg-gradient-to-r from-primary/10 to-primary/5 border-b-2 border-primary px-4 md:px-6 py-4 md:py-5">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3">
            <h2 class="text-xl md:text-2xl font-bold text-gray-900 flex items-center gap-2">
                <svg class="w-6 h-6 md:w-7 md:h-7 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Upcoming Events
            </h2>
            {% if is_admin %}
            <a href="{% url 'calendar_app:create_event' %}"
                class="bg-primary text-black px-4 py-2 rounded font-bold hover:opacity-90 transition shadow-md text-sm md:text-base whitespace-nowrap">
                + Create Event
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Event List -->
    <div class="p-4 md:p-6">
        <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
            {% for event in events %}
            <div
                class="bg-white border border-gray-200 rounded-lg p-5 hover:border-primary transition duration-300 group relative overflow-hidden flex flex-col shadow-sm hover:shadow-md">
                <!-- Type Badge -->
                <span
                    class="absolute top-2 right-2 px-2 py-0.5 text-xs rounded bg-gray-100 text-gray-600 uppercase font-medium border border-gray-200">
                    {{ event.get_event_type_display }}
                </span>

                <div class="mb-4">
                    <h3 class="text-xl font-bold text-gray-900 group-hover:text-primary transition">{{ event.title }}
                    </h3>
                    <p class="text-sm text-gray-500 flex items-center gap-2 mt-1">
                        <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                            </path>
                        </svg>
                        {{ event.start_time|date:"D, M j, Y @ H:i" }}
                    </p>
                    {% if event.location %}
                    <p class="text-sm text-gray-500 flex items-center gap-2 mt-1">
                        <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z">
                            </path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        {{ event.location }}
                    </p>
                    {% endif %}
                </div>

                {% if is_admin %}
                <form method="post" action="{% url 'calendar_app:delete_event' event.id %}"
                    class="absolute top-2 left-2 z-10"
                    onsubmit="return confirm('Are you sure you want to delete this event?');">
                    {% csrf_token %}
                    <button type="submit"
                        class="bg-white hover:bg-red-50 text-red-500 border border-red-200 rounded-full p-1 w-6 h-6 flex items-center justify-center text-xs ml-auto transition shadow-sm">
                        &times;
                    </button>
                </form>
                {% endif %}

                <!-- RSVP Section -->
                <div class="border-t border-gray-100 pt-4 mt-auto">
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-gray-500 font-medium uppercase tracking-wide">Status</span>
                        <span
                            class="text-sm font-bold {% if event.user_status == 'attending' %}text-green-600{% elif event.user_status == 'unavailable' %}text-red-500{% else %}text-orange-500{% endif %}">
                            {{ event.user_status|default:'Pending'|title }}
                        </span>
                    </div>

                    <div class="grid grid-cols-2 gap-2 mt-3">
                        <a href="{% url 'calendar_app:rsvp_event' event.id 'attending' %}"
                            class="text-center px-3 py-1.5 rounded bg-green-50 hover:bg-green-100 text-green-700 font-medium text-xs transition border border-green-200">Going</a>
                        <a href="{% url 'calendar_app:rsvp_event' event.id 'unavailable' %}"
                            class="text-center px-3 py-1.5 rounded bg-red-50 hover:bg-red-100 text-red-700 font-medium text-xs transition border border-red-200">Can't
                            Go</a>
                    </div>
                </div>
            </div>
            {% empty %}
            <div
                class="col-span-full text-center py-12 md:py-20 bg-gray-50 rounded-lg border-2 border-gray-200 border-dashed">
                <svg class="w-12 h-12 md:w-16 md:h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                    </path>
                </svg>
                <p class="text-gray-400 text-base md:text-lg font-medium">No upcoming events found.</p>
                {% if is_admin %}
                <p class="mt-2"><a href="{% url 'calendar_app:create_event' %}"
                        class="text-primary hover:underline font-bold">Create your
                        first event</a></p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
